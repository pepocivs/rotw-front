<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../component-recipes/component-recipes.html">
<link rel="import" href="../component-infobar/component-infobar.html">

<dom-module id="btw-recipes">
    <template>
      <style>
        :host {
          display: block;
        }
      </style>
      <iron-ajax auto
      url="http://zelda.pepocivs.com/recipes"
      params="{{params}}"
      handle-as="json"
      last-response="{{recipesResponse}}"></iron-ajax>

      <component-infobar title="{{availableTitle}}"></component-infobar>
      <component-recipes recipe-list="[[recipeList.available]]"></component-recipes>

      <component-infobar title="{{possibleTitle}}"></component-infobar>
      <component-recipes recipe-list="[[recipeList.possible]]"></component-recipes>

      <component-infobar title="{{unavailableTitle}}"></component-infobar>
      <component-recipes recipe-list="[[recipeList.unavailable]]"></component-recipes>

    </template>

    <script>
        Polymer({
            is: 'btw-recipes',
            properties: {
              recipesResponse: {
                type: Object,
                observer: '_recipesResponse'
              },
              availableTitle: {
                type: String
              },
              possibleTitle: {
                type: String
              },
              unavailableTitle: {
                type: String
              },
              params: {
                type: Object,
                value: {
                  'inventory': '[{"itemId":3,"count":3},{"itemId":9,"count":1},{"itemId":10,"count":3},{"itemId":11,"count":2},{"itemId":17,"count":5},{"itemId":22,"count":3}]'
                }
              }
            },
            observers: [],
            _recipesResponse: function(response) {
              this.recipeList = response;
              var availableText  = (this.recipeList.available.length === 1) ? 'receta' : 'recetas';
              this.availableTitle   = "Disponibles - "+this.recipeList.available.length+" "+availableText;
              var possibleText  = (this.recipeList.possible.length === 1) ? 'receta' : 'recetas';
              this.possibleTitle   = "Posibles - "+this.recipeList.possible.length+" "+possibleText;
              var unavailableText  = (this.recipeList.unavailable.length === 1) ? 'receta' : 'recetas';
              this.unavailableTitle   = "No Disponibles - "+this.recipeList.unavailable.length+" "+unavailableText;
            },
        });
    </script>
</dom-module>
