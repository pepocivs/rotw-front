<link rel="import" href="../../bower_components/dom-repeat-n/dom-repeat-n.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../general-style.html">
<link rel="import" href="recipes-style.html">

<dom-module id="component-recipes">
    <template>
      <style include="recipes-style general-style iron-flex iron-flex-alignment">
        :host {
          display: block;
        }
      </style>

      <template is="dom-if" if="[[showBar]]">
        <div class="info-black layout horizontal wrap center around-justified">
          <iron-icon src="../../images/pira.svg"></iron-icon>
          <span class="flex">{{title}} - {{recipeList.length}} recetas</span>
          <!-- <iron-icon  icon="icons:search"></iron-icon> -->
        </div>
      </template>

      <div class="layout horizontal wrap center-center"style="background-color: white;">

        <template is="dom-repeat" items="[[recipes]]">

            <div class="food-box-form layout horizontal nowrap center-center justified" >
              <div  style="width: 24%;margin-right: 9px;">
                <img src="{{item.image}}" alt="{{item.name}}" class="foodprincipal">
              </div>
              <div class="food-box-one flex three wrap  self-start">
                <p>{{item.name}}</p>
                <div class="flex wrapText grey">{{item.description}}</div>
                <template is="dom-repeat" items="{{item.effectsToPrint}}" as="effect" index-as="x">
                    <img src="{{effect.icon}}" value="{{effect._id}}" alt="" class="img-efects">
                </template>
              </div>
              <div class="v"></div>
              <div class="flex one food-box-two  self-start">
                <template is="dom-repeat" items="{{item.ingredients}}" as="ingredient" index-as="x">
                  <template is="dom-repeat-n" count="{{ingredient.howMany}}">
                    <img src="{{ingredient.image}}" value="{{ingredient._id}}" alt="" class="img-ingredients" />
                  </template>
                </template>
                <iron-icon src="{{item.craftingIcon}}"></iron-icon>
              </div>
            </div>

        </template>
      </div>
    </template>

    <script>
        Polymer({
            is: 'component-recipes',
            properties: {
              recipeList: {
                type: Object,
                observer: '_formatRecipe'
              },
              recipes: {
                type: Object
              },
              title: {
                type: String
              },
              showBar: {
                type: Boolean,
                value: false
              }
            },
            observers: [],
            _formatRecipe: function() {
              if (!this.isArray(this.recipeList)) {
                this.recipes = [this.recipeList];
              } else {
                this.recipes = this.recipeList;
              }
            },
            isArray: function(e) {
              return (Object.prototype.toString.call(e) === '[object Array]')
            },
            _recipesResponse: function() {
              for (var i = 0; i < this.response.length; i++) {
                this.response[i].effectsToPrint = [];
                for (var x = 0; x < this.response[i].effects.length; x++) {
                  if (this.response[i].effects[x].icon.indexOf('/ic_heart_red.png') > 0) {
                      var n = Math.floor(this.response[i].effects[x].value);
                      var m = (this.response[i].effects[x].value - n);
                      for (var j = 0; j < n; j++ ) {
                        this.response[i].effectsToPrint.push({
                          "_id": this.response[i].effects[x]._id,
                          "name": this.response[i].effects[x].name,
                          "icon": this.response[i].effects[x].icon,
                          "value": "1"
                        });
                      }
                      if (m === 0.25) {
                        this.response[i].effectsToPrint.push({
                          "_id": this.response[i].effects[x]._id,
                          "name": this.response[i].effects[x].name,
                          "icon": "http://zelda.pepocivs.com/images/ic_heart_red_quarter.png",
                          "value": "1"
                        });
                      } else if (m === 0.50) {
                        this.response[i].effectsToPrint.push({
                          "_id": this.response[i].effects[x]._id,
                          "name": this.response[i].effects[x].name,
                          "icon": "http://zelda.pepocivs.com/images/ic_heart_red_half.png",
                          "value": "1"
                        });
                      } else if (m === 0.75) {
                        this.response[i].effectsToPrint.push({
                          "_id": this.response[i].effects[x]._id,
                          "name": this.response[i].effects[x].name,
                          "icon": "http://zelda.pepocivs.com/images/ic_heart_red_three_quarter.png",
                          "value": "1"
                        });
                      }
                  }
                }
              }
              // console.log(this.response);
              this.recipeList = this.response;
            },
        });
    </script>
</dom-module>
